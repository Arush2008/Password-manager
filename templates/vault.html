<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>My Page</title>
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='style.css') }}"
    />
    <link
      rel="stylesheet"
      href="https://site-assets.fontawesome.com/releases/v6.7.2/css/all.css"
    />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link
      href="https://fonts.googleapis.com/css2?family=Pacifico&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/remixicon/4.6.0/remixicon.min.css"
    />
    <script src="{{ url_for('static', filename='script.js') }}"></script>
  </head>
  <body class="vault_page">
    
    <!-- Top Bar -->
    <div class="top_part">
      <div class="top-left">
        <a href="{{ url_for('views.index') }}" class="logo-page2">webi</a>
        <div class="search-bar">
          <input type="text" placeholder="Search..." />
          <button type="submit">Search</button>
        </div>
      </div>
      <div class="top-right">
        <button class="icon-button notification">
          <i class="fa-regular fa-bell"></i>
        </button>
        <button class="icon-button settings">
          <i class="fa-regular fa-gear"></i>
        </button>
        <div class="profile-avatar">A</div>
      </div>
    </div>

    <!-- Sidebar -->
    <div class="sidebar">
      <div class="sidebar-content">
        <div class="sidebar_titles">Categories</div>

        <a href="{{url_for('views.vault', category='All Passwords')}}">
          <div class="sidebar-text {%if category == 'All Passwords'%}active{% endif %}">
            <i class="fa-regular fa-lock-keyhole"></i>
            <span>All Passwords</span>
          </div>
        </a>

        <a href="{{url_for('views.vault', category='Personal')}}">
          <div class="sidebar-text {%if category == 'Personal'%}active{% endif %}">
            <i class="ri-user-line"></i>
            <span>Personal</span>
          </div>
        </a>

        <a href="{{url_for('views.vault', category='Work')}}">
          <div class="sidebar-text {%if category == 'Work'%}active{% endif %}">
            <i class="fa-regular fa-briefcase"></i>
            <span>Work</span>
          </div>
        </a>

        <a href="{{url_for('views.vault', category='Finance')}}">
          <div class="sidebar-text {%if category == 'Finance'%}active{% endif %}">
            <i class="fa-regular fa-wallet"></i>
            <span>Finance</span>
          </div>
        </a>

        <a href="{{url_for('views.vault', category='Gaming')}}">
          <div class="sidebar-text {%if category == 'Gaming'%}active{% endif %}">
            <i class="fa-regular fa-gamepad-modern"></i>
            <span>Gaming</span>
          </div>
        </a>

        <div class="sidebar-text">
          <i class="fa-solid fa-plus"></i>
          <span>Add Category</span>
        </div>

        <!-- Invisible divider between Categories and Quick Actions -->
        <hr class="invisible-divider" />

        <!-- Quick Actions Section -->
        <div class="sidebar_titles">Quick Actions</div>

        <a href="{{ url_for('views.vault', category=category, popup='password-generator') }}">
          <div class="sidebar-text" id="password-generator-btn">
            <i class="fa-regular fa-key"></i>
            <span>Password Generator</span>
          </div>
        </a>

        <a href="{{ url_for('views.vault', category=category, popup='add-new-entry') }}">
          <div class="sidebar-text">
            <i class="fa-regular fa-circle-plus"></i>
            <span>Add New Entry</span>
          </div>
        </a>

        <div class="sidebar-text">
          <i class="fa-regular fa-shield-check"></i>
          <span>Security Check</span>
        </div>

        <div class="sidebar-text">
          <i class="ri-refresh-line"></i>
          <span>Sync Now</span>
        </div>
      </div>

      <!-- Bottom Divider -->
      <hr class="bottom-divider" />

      <!-- Auto-logout section -->
      <div class="logout-box">
        <div class="logout-header">
          <span>Auto-logout in</span>
          <span class="time">14:32</span>
        </div>
        <div class="progress-bar">
          <div class="progress-fill"></div>
        </div>
      </div>
    </div>

    <!-- Main Content -->
    <div class="main-content">
      {% if category == 'All Passwords' %}
        <h2>All Passwords</h2>
      {% elif category == 'Personal' %}
        <h2>Personal Passwords</h2>
      {% elif category == 'Work' %}
        <h2>Work Passwords</h2>
      {% elif category == 'Finance' %}
        <h2>Finance Passwords</h2>
      {% elif category == 'Gaming' %}
        <h2>Gaming Passwords</h2>
      {% else %}
        <h2>Unknown Category</h2>
      {% endif %}
      
      <!-- Display saved passwords -->
      {% if passwords %}
        <div class="password-list">
          {% for password in passwords %}
            <div class="password-card">
              <div class="password-header">
                <h3>{{ password.site_name }}</h3>
                <span class="password-category">{{ password_categories.get(password['id'], 'Unknown') }}</span>
              </div>
              <div class="password-details">
                <p><strong>Username:</strong> {{ password.site_username }}</p>
                <p><strong>Password:</strong> {{ "â€¢" * password.site_password|length }}</p>
                {% if password.url %}
                  <p><strong>URL:</strong> <a href="{{ password.url }}" target="_blank">{{ password.url }}</a></p>
                {% endif %}
                {% if password.notes %}
                  <p><strong>Notes:</strong> {{ password.notes }}</p>
                {% endif %}
              </div>
              <div class="password-actions">
                <a href="{{ url_for('views.vault', category=category, popup='edit-entry', id=password['id']) }}"><i class="fa-regular fa-pen-to-square"></i></a>
                <a class="btn-delete" href="{{ url_for('views.delete_password', id=password['id']) }}" onclick="return confirm('Are you sure you want to delete this password?');"><i class="fa-regular fa-trash"></i></a>
              </div>
            </div>
          {% endfor %}
        </div>
      {% else %}
        <p>No passwords saved in this category yet. <a href="{{ url_for('views.vault', category=category, popup='add-new-entry') }}">Add your first password entry!</a></p>
      {% endif %}
    </div>

    <!------------------------------------- Password Generator Popup ------------------------------------->
    {% if show_password_generator_popup %}
    <div class="popup-overlay">
      <div class="popup-content">
        <a href="{{ url_for('views.vault', category=category) }}" class="close-btn">&times;</a>

        <!-- Generated Password Display Section -->
        <div class="password-display-section">
          <label for="generated-password">Generated Password:</label>
          <div class="password-output-container">
            <div class="password-output">
              <input type="text" id="generated-password" class="password-output-input" value="{{ generated_password }}" readonly>
              <a href="{{ url_for('views.vault', category=category, popup='password-generator', length=password_length-1) }}" class="refresh-btn" title="Generate new password">
                <i class="ri-refresh-line"></i>
              </a>
              <button type="button" class="copy-btn" title="Copy Password" onclick="navigator.clipboard.writeText(document.getElementById('generated-password').value)">
                <i class="fa-regular fa-copy"></i>
              </button>
            </div>
          </div>
          
          <!-- Password Length Controls -->
          <div class="password-length-section">
            <label for="password-length">Password Length: <span id="length-display">{{ password_length }}</span></label>
            <div class="length-controls">
              <a href="{{ url_for('views.vault', category=category, popup='password-generator', length=password_length-1) }}" 
                 class="length-btn {% if password_length <= 8 %}disabled{% endif %}">-</a>
              <input type="range" min="8" max="32" value="{{ password_length }}" class="slider" id="myRange">
              <a href="{{ url_for('views.vault', category=category, popup='password-generator', length=password_length+1) }}" 
                 class="length-btn {% if password_length >= 32 %}disabled{% endif %}">+</a>
            </div>

            <!-- Password Options -->
            <div class="password-options-section">
              <div class="options">
                <label><input type="checkbox" name="include_uppercase" {% if include_uppercase %}checked{% endif %}> Uppercase Letters <span class="option-example">(A-Z)</span></label>
                <label><input type="checkbox" name="include_lowercase" {% if include_lowercase %}checked{% endif %}> Lowercase Letters <span class="option-example">(a-z)</span></label>
                <label><input type="checkbox" name="include_numbers" {% if include_numbers %}checked{% endif %}> Numbers <span class="option-example">(0-9)</span></label>
                <label><input type="checkbox" name="include_symbols" {% if include_symbols %}checked{% endif %}> Special Characters <span class="option-example">(!@#$%^&*)</span></label>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    {% endif %}

    <!------------------------------------- Add New Entry Popup ------------------------------------->
    {% if show_new_entry_popup %}
    <div class="popup-2-overlay">
      <div class="popup-2-content">
        <h2>Add New Entry</h2>
        <a href="{{ url_for('views.vault', category=category) }}" class="close-btn">&times;</a>
        <div>
          <form method="POST" action="{{ url_for('views.vault') }}">
            <label for="title" class="text-label">Website/App</label><br>
            <input type="text" id="title" name="title" class="text-input" maxlength="15" required><br>

            <label for="username" class="text-label">Username/Email</label><br>
            <input type="text" id="username" name="username" class="text-input" maxlength="15" required><br>

            <label for="password" class="text-label">Password</label><br>
            <input type="password" id="password" name="password" class="text-input" minlength="8" required><br>

            <label for="url" class="text-label">Website URL (optional)</label><br>
            <input type="url" id="url" name="url" class="text-input" placeholder="https://example.com"><br>

            <label for="category" class="text-label">Category</label><br>
            <select id="category" name="category" class="text-input">
              <option value="Personal" {% if category == 'Personal' %}selected{% endif %}>Personal</option>
              <option value="Work" {% if category == 'Work' %}selected{% endif %}>Work</option>
              <option value="Finance" {% if category == 'Finance' %}selected{% endif %}>Finance</option>
              <option value="Gaming" {% if category == 'Gaming' %}selected{% endif %}>Gaming</option>
            </select><br>

            <label for="notes" class="text-label">Notes (optional)</label><br>
            <textarea id="notes" name="notes" class="text-input" maxlength="50"></textarea><br>

            <input type="submit" id="save-password-btn" name="save-password-btn" value="Save Password">
            <a href="{{ url_for('views.vault', category=category) }}" class="cancel-btn">Cancel</a>
          </form>
        </div>
      </div>
    </div>
    {% endif %}

    <!------------------------------------- Edit Entry Popup ------------------------------------->

    {% if show_edit_entry_popup %}
    <div class="popup-2-overlay">
      <div class="popup-2-content">
        <h2>Edit Entry</h2>
        <a href="{{ url_for('views.vault', category=category) }}" class="close-btn">&times;</a>
        <div>
          <form method="POST" action="{{ url_for('views.vault') }}">
            <input type="hidden" name="password_id" value="{{ edit_password_data['id'] }}">
            
            <label for="title" class="text-label">Website/App</label><br>
            <input type="text" id="title" name="title" class="text-input" value="{{ edit_password_data['site_name'] }}" maxlength="15" required><br>

            <label for="username" class="text-label">Username/Email</label><br>
            <input type="text" id="username" name="username" class="text-input" value="{{ edit_password_data['site_username'] }}" maxlength="15" required><br>

            <label for="password" class="text-label">Password</label><br>
            <input type="password" id="password" name="password" class="text-input" value="{{ edit_password_data['site_password'] }}" minlength="8" required><br>

            <label for="url" class="text-label">Website URL (optional)</label><br>
            <input type="url" id="url" name="url" class="text-input" value="{{ edit_password_data['url'] or '' }}" placeholder="https://example.com"><br>

            <label for="category" class="text-label">Category</label><br>
            <select id="category" name="category" class="text-input">
              <option value="Personal">Personal</option>
              <option value="Work">Work</option>
              <option value="Finance">Finance</option>
              <option value="Gaming">Gaming</option>
            </select><br>

            <label for="notes" class="text-label">Notes (optional)</label><br>
            <textarea id="notes" name="notes" class="text-input" maxlength="50">{{ edit_password_data['notes'] or '' }}</textarea><br>

            <input type="submit" id="save-password-btn" name="save-password-btn" value="Update Password">
            <a href="{{ url_for('views.vault', category=category) }}" class="cancel-btn">Cancel</a>
          </form>
        </div>
      </div>
    </div>
    {% endif %}

  </body>
</html>